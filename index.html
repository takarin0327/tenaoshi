<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>手直し登録</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.min.css">
<style>
body {
    background-color: #e8f5e9; /* 薄い緑色の背景 */
}
.required::after {
  content: "必須";
  background-color: #f0ad4e;
  color: #fff;
  font-size: 12px;
  font-weight: bold;
  min-width: 10px;
  padding: 3px 7px;
  margin: 0px 5px;
  line-height: 1;
  vertical-align: middle;
  white-space: nowrap;
  text-align: center;
  border-radius: 10px;
  display: inline-block;
}
.header-title {
    text-align: center;
    font-size: 24px;
    font-weight: bold;
    color: black; /* タイトルの文字色 */
    margin: 20px 0;
}
.form-label {
    font-weight: bold;
    color: red;
}
.hide {
    display: none;
}
</style>
</head>
<body>

    <div class="header-title">手直し登録</div>

    <form class="w-75 mx-auto">
        <p class="mt-3 mb-0 required form-label">内職者グループ</p>
        <div>
            <select class="form-control w-100 mt-1" id="workerGroup" required>
                <option value="">選択してください</option>
                <option value="A">あ行</option>
                <option value="ka">か行</option>
                <option value="sa">さ行</option>
                <option value="ta">た行</option>
                <option value="na">な行</option>
                <option value="ha">は行</option>
                <option value="ma">ま行</option>
                <option value="ya">や行</option>
                <option value="ra">ら行</option>
                <option value="wa">わ行</option>
            </select>
        </div>

        <p class="mt-3 mb-0 required form-label">内職者名</p>
        <div>
            <select class="form-control w-100 mt-1" id="workerName" required></select>
        </div>

        <p class="mt-3 mb-0 form-label">検品者</p>
        <div>
            <input class="form-control w-100 mt-1" name="name" placeholder="" required>
        </div>
        <p class="mt-3 mb-0 required form-label">手直し数</p>
        <p class="mb-0">手直しした数をご記入ください。<br>
            なしの場合は<span>【0】</span>と入力してください。（影響なく報酬は発生します）</p>
        <div>
            <input class="form-control w-100 mt-1" name="udetate" required>
        </div>
        <p class="mt-3 mb-0 required form-label">納品数</p>
        <p class="mb-0">納品された数をご記入ください。</p>
        <div>
            <input class="form-control w-100 mt-1" name="fukkin" required>
        </div>
        <p class="mt-3 mb-0 form-label">初期不良数</p>
        <p class="mb-0">キズ等、制作できなかった数をご記入ください。（報酬は発生しません）</p>
        <div>
            <input class="form-control w-100 mt-1" name="haikin" required>
        </div>
        <p class="mt-3 mb-0 form-label">納品備考</p>
        <p class="mb-0">納品数が指定数ではない場合の理由をお選びください。</p>
        <div>
            <label><input type="radio" name="reason" value="体調不良"> 体調不良</label>
            <label><input type="radio" name="reason" value="初期不良"> 初期不良</label>
            <label><input type="radio" name="reason" value="その他"> その他</label>
        </div>
        <div id="otherReason" class="hide">
            <p class="mt-3 mb-0 form-label">その他内容</p>
            <input class="form-control w-100 mt-1" name="other_content" placeholder="その他の内容を記入">
        </div>

        <p class="mt-3 mb-0 form-label">NG個数</p>
        <p class="mb-0">手直しが効かず、作り直さないといけない数をご記入ください。（報酬は発生しません）</p>
        <div>
            <input class="form-control w-100 mt-1" name="haikin" required>
        </div>
        <p class="mt-3 mb-0 form-label">手直し点</p>
        <p class="mb-0">簡潔に箇条書きでご記入ください。<br>
            複数ある場合➡【・】で区切る<br>
            例：・角コバむら ・ポケットズレ
        </p>
        <div>
            <input class="form-control w-100 mt-1" name="haikin" required>
        </div>

        <input type="submit" class="mt-4 btn btn-primary" value="送信">
    </form>

<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" crossorigin="anonymous"></script>
<script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
<script async defer src="https://apis.google.com/js/api.js"></script>
<script>
    function initializeLiff(liffId) {
        liff.init({
            liffId: liffId
        }).then(() => {
            console.log("LIFF initialized!");
            // ここに初期化後の処理を書く
        }).catch((err) => {
            console.error('LIFF Initialization failed', err);
        });
    }

    function initClient() {
        gapi.load('client:auth2', function() {
            gapi.auth2.init({client_id: '942349803399-hsn4kv18se755b6id4s73cpb6l82ut1b.apps.googleusercontent.com'}).then(function(){
                gapi.client.init({
                    apiKey: 'AIzaSyBtMDqgVke-2Ji_q5HNqXJc3KF6lZeIVX4',
                    clientId: '942349803399-hsn4kv18se755b6id4s73cpb6l82ut1b.apps.googleusercontent.com',
                    scope: 'https://www.googleapis.com/auth/spreadsheets.readonly',
                    discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
                }).then(function () {
                    console.log("Google API client initialized.");
                    loadOptions();
                });
            });
        });
    }

    $(document).ready(function () {
    const liffId = "2005926419-8YQOpOqd";
    initializeLiff(liffId);

    $('#workerGroup').change(function () {
        const group = $(this).val();
        updateWorkerNames(group);
    });

    function updateWorkerNames(group) {
        let range = '内職連絡先一覧!' + group + ':' + group; // groupは 'C:C' のように正しい形式であることを確認してください
        gapi.client.sheets.spreadsheets.values.get({
            spreadsheetId: '1InH2PHiy-5NVHOTI9O-CiUMPZqD4M52HjmHGRLYjvyg', // 正しいスプレッドシートIDに置き換えてください
            range: range,
        }).then(function(response) {
            var range = response.result;
            if (range.values && range.values.length > 0) {
                $('#workerName').empty();
                range.values.forEach(function(row) {
                    $('#workerName').append(`<option value="${row[0]}">${row[0]}</option>`);
                });
            } else {
                console.log('No data found.');
                $('#workerName').empty().append('<option value="">データが見つかりません</option>');
            }
        }, function(response) {
            console.error('Error loading data from Sheets: ' + response.result.error.message);
        });
    }

    gapi.load('client:auth2', initClient); // 'client'から'client:auth2'に変更して、認証も含めた初期化を行います
});


    $(document).ready(function () {
        const liffId = "2005926419-8YQOpOqd";
        initializeLiff(liffId);
        
        $('input[type="radio"][name="reason"]').change(function() {
            if (this.value === 'その他') {
                $('#otherReason').show();
            } else {
                $('#otherReason').hide().find('input[name="other_content"]').val('');
            }
        });

        $('form').submit(function () {
            const name = $('input[name="name"]').val();
            const udetate = $('input[name="udetate"]').val();
            const fukkin = $('input[name="fukkin"]').val();
            const haikin = $('input[name="haikin"]').val();
            const msg = `${name}\n${udetate}\n${fukkin}\n${haikin}`;
            sendText(msg);
            return false;
        });

        gapi.load('client', initClient);

        function initClient() {
            gapi.client.init({
                apiKey: 'AIzaSyBtMDqgVke-2Ji_q5HNqXJc3KF6lZeIVX4',
                discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
            }).then(function () {
                loadOptions();
            }).catch(function(error) {
                console.error('Error initializing Google API client: ' + error);
            });
        }

        function loadOptions() {
            gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: '1InH2PHiy-5NVHOTI9O-CiUMPZqD4M52HjmHGRLYjvyg',
                range: 'Sheet1!A:A',
            }).then(function(response) {
                var range = response.result;
                if (range.values && range.values.length > 0) {
                    $('select[name="name"]').empty();
                    range.values.forEach(function(row) {
                        $('select[name="name"]').append(`<option value="${row[0]}">${row[0]}</option>`);
                    });
                } else {
                    console.log('No data found.');
                }
            }, function(response) {
                console.error('Error loading data from Sheets: ' + response.result.error.message);
            });
        }
    });
</script>


</body>
</html>
